{% extends "base.html" %}
{% load static %}
{% block content %}
<!-- <meta name="keywords" content="HTML5" />
<meta name="description" content="HTML5" />
<meta name="author" content="js" />
<meta name="copyright" content="js" /> -->
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<div class="content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card gradient-forest">
                    <div class="card gradient-forest">
                        <h4 style="color: white">本节测试</h4>
                    </div>
                        
                    <div class="card-body text-center p-5">
                        <div class="table-responsive">
                            <div id="default-datatable_wrapper"
                                class="dataTables_wrapper container-fluid dt-bootstrap4">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <table class="table table-dark table-striped shadow-dark" role="grid"
                                            aria-describedby="default-datatable_info">
                                            <tbody>
                                                {% csrf_token %}
                                                {% for i in list_dic %}
                                                <input type="hidden" name="book_id" value="{{ i.book_id }}">
                                                <div class="dan{{ i.num}}">
                                                    <p>{{i.num}}. {{ i.title }}</p>
                                                    <p><input type="radio" name="dan{{ i.num}}" value="{{i.A}}"><label for="dA{{ i.num}}">A. {{i.A}}</p>
                                                    <p><input type="radio" name="dan{{ i.num}}" value="{{i.B}}"><label for="dB{{ i.num}}">B. {{i.B}}</p>
                                                    <p><input type="radio" name="dan{{ i.num}}" value="{{i.C}}"><label for="dC{{ i.num}}">C. {{i.C}}</p>
                                                    <p><input type="radio" name="dan{{ i.num}}" value="{{i.D}}"><label for="dD{{ i.num}}">D. {{i.D}}</p>
                                                </div>
                                                <span>=======================================================<span>
                                                        {% endfor %}
                                            </tbody>

                                        </table>
                                    </div>
                                </div>
                                <div class="modal fade" id="modal-animation-9">
                                    <div class="modal-dialog">
                                        <div class="modal-content animated wobble">
                                            <div class="modal-header">
                                                <h5 class="modal-title">确认弹框</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <p>你确认修改这条数据吗？</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger" data-dismiss="modal"><i
                                                        class="fa fa-times"></i> 关闭
                                                </button>
                                                <button type="submit" class="btn btn-success"><i
                                                        class="fa fa-check-square-o" onclick="submitForm()"></i> 修改
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button type="button"
                                        class="btn btn-primary btn-lg btn-block waves-effect waves-light m-1"
                                        data-toggle="modal" data-target="#modal-animation-9"><i
                                            class="zmdi zmdi-check-circle"></i>提交
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>End Row

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>

    <script>
        function submitForm(){
            let arr_1=[]
            for(let i=1;i<10;i++){
                let name = 'dan'+i
                var timeSlotId=$("input[name="+name+"]:checked").val()
                console.log(timeSlotId)
                if(timeSlotId==undefined){
                    alert('请检查题目是否全部回答完毕！')
                    return false
                }
                arr_1.push(timeSlotId)
            }
            console.log(arr_1)
            let book_id = $("input[name='book_id']").val()
            console.log(book_id)
            
            let data={'book_id':book_id,'resolt':JSON.stringify(arr_1)}
            console.log(data)
            $.ajax({
                url:"http://127.0.0.1:8000/librarian/test_data_update/",    //请求的url地址
                dataType:"json",   //返回格式为json
                async:false,//请求是否异步，默认为异步true，这也是ajax重要特性
                data:data,    //参数值
                type:"POST",   //请求方式
                success:function(req){
                    console.log(req)
                    console.log('jinlaile ')
                },
                error:function(){
                    //请求出错处理
                }
            });
            url_validation = 'http://127.0.0.1:8000/librarian/test_validation/?book_id'+'='+book_id
            console.log(url_validation)

            document.location.href=url_validation
        }
    </script>

    {% endblock %}